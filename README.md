Лабораторная работа 5 (вариант 15)
Выполнила: Сальникова Марина ИТ-8

Цель работы: Разработать консольное приложение для управления базой данных аудиозаписей с использованием LINQ-запросов, чтением/записью из/в Excel файлы и дружественным интерфейсом.

Функциональные требования:
Чтение/запись данных из/в Excel файл
Просмотр всех таблиц базы данных
Удаление элементов по ключу с проверкой ссылочной целостности
Добавление новых элементов с валидацией
Выполнение 4 типов запросов
Сохранение изменений в Excel

Технологии: C#, .NET 8.0, LINQ, ClosedXML для работы с Excel

Реализация основных компонентов
1. Класс DataHelper
  Читает 4 листа: "Артисты", "Жанры", "Альбомы", "Треки"
  public List<Artist> Artists { get; private set; } = new();
  public List<Genre> Genres { get; private set; } = new();
  public List<Album> Albums { get; private set; } = new();
  public List<Track> Tracks { get; private set; } = new();

  Загрузка данных из Excel
  public void LoadFromExcel(string filePath) - Использует библиотеку ClosedXML, Автоматически определяет количество строк, Обрабатывает исключения при отсутствии файла.

  Сохранение данных в Excel
  public void SaveToExcel(string filePath) - Создает новый файл или перезаписывает существующий, Сохраняет все 4 коллекции на отдельные листы, Сохраняет форматирование заголовков.

  Методы удаления с проверкой целостности
  public void DeleteArtist(int id) - Проверяет существование артиста, Проверяет, есть ли связанные альбомы, Удаляет только если нет зависимых записей.
  Аналогично для: DeleteGenre(), DeleteAlbum(), DeleteTrack()

  Методы добавления с валидацией
  public void AddArtist(Artist artist) - Проверяет уникальность ID, Сортирует коллекцию после добавления, Проверяет существование внешних ключей.
  Аналогично для: AddGenre(), AddAlbum(), AddTrack()

  Реализация LINQ-запросов
Запрос 1: К одной таблице
// Треки длительностью более 5 минут
public List<Track> GetLongTracks(long minDuration = 5 * 60 * 1000)
{
    return Tracks.Where(t => t.Duration > minDuration).ToList();
}
Формулировка: "Найти все треки, длительность которых превышает 5 минут"

Запрос 2: К двум таблицам
csharp
// Альбомы с именами исполнителей
public List<string> GetAlbumsWithArtists()
{
    return (from album in Albums
            join artist in Artists on album.ArtistId equals artist.ID
            orderby artist.Name, album.Title
            select $"{album.Title} - {artist.Name}").ToList();
}
Формулировка: "Получить список всех альбомов с указанием имени исполнителя"

Запрос 3: К трем таблицам (возвращает перечень)
csharp
// Треки с информацией о жанре и исполнителе
public List<string> GetTracksWithGenreAndArtist()
{
    return (from track in Tracks
            join album in Albums on track.AlbumId equals album.ID
            join artist in Artists on album.ArtistId equals artist.ID
            join genre in Genres on track.GenreId equals genre.ID
            orderby artist.Name, album.Title, track.Title
            select $"{track.Title} | Альбом: {album.Title} | Исполнитель: {artist.Name} | ...").ToList();
}
Формулировка: "Получить детальную информацию о треках: название трека, альбом, исполнитель, жанр, длительность и стоимость"

Запрос 4: К трем таблицам (возвращает одно значение)
csharp
// Общая стоимость треков в жанре Blues
public decimal GetTotalCostForBlues()
{
    var bluesGenre = Genres.FirstOrDefault(g => g.Name.Equals("Blues", StringComparison.OrdinalIgnoreCase));
    if (bluesGenre == null) return 0;
    
    return (from track in Tracks
            where track.GenreId == bluesGenre.ID
            select track.Cost).Sum();
}
Формулировка: "Рассчитать общую стоимость всех треков в жанре Blues"

(Program.cs)

ГЛАВНОЕ МЕНЮ:
1. Загрузить данные из Excel
2. Просмотреть данные
3. Удалить элемент
4. Добавить элемент
5. Выполнить запросы
6. Сохранить изменения в Excel
0. Выход
   
Особенности реализации:
Обработка ошибок: try-catch блоки во всех критических операциях
Валидация ввода: проверка корректности введенных данных
Дружественный интерфейс: подсказки, подтверждения действий
Поддержка путей: автоматическое определение пути к файлу

Функции меню:
LoadData() - загрузка с указанием пути к файлу
ViewDataMenu() - просмотр отдельных таблиц или всех сразу
DeleteMenu() - удаление с выбором таблицы и ID
AddMenu() - интерактивное добавление с запросом всех полей
QueryMenu() - выполнение 4 LINQ-запросов
SaveData() - сохранение с подтверждением

Формулировки запросов
Запрос к одной таблице: "Найти все треки, длительность которых превышает 5 минут (300 000 миллисекунд)"
Запрос к двум таблицам: "Получить список всех альбомов с указанием имени исполнителя, отсортированный по имени исполнителя и названию альбома"
Запрос к трем таблицам (перечень): "Получить детальную информацию о треках: название трека, альбом, исполнитель, жанр, длительность (в формате мм:сс) и стоимость в рублях"
Запрос к трем таблицам (одно значение): "Рассчитать общую стоимость всех треков в жанре Blues"

Приложение обрабатывает следующие типы исключений:
FileNotFoundException - при отсутствии файла Excel
FormatException - при некорректном вводе числовых значений
IOException - при ошибках чтения/записи файлов
Exception - общая обработка всех остальных ошибок
Все методы содержат блоки try-catch с информативными сообщениями об ошибках.

Структура Excel-файла
Файл LR5-var15.xlsx содержит 4 листа:
Лист "Артисты"
ID	Имя
1	The Beatles
2	Queen
Лист "Жанры"
ID	Название
1	Rock
2	Blues
Лист "Альбомы"
ID	Название	ID Исполнителя
1	Abbey Road	1
2	A Night at the Opera	2
Лист "Треки"
ID	Название трека	ID альбома	ID жанра	Длительность	Размер	Стоимость
1	Come Together	1	1	259000	10240000	150.50

Инструкция по использованию
Запуск приложения: Запустить ConsoleApp5.67.exe
Загрузка данных: Выбрать пункт 1, указать путь к файлу LR5-var15.xlsx
Просмотр данных: Пункт 2 → выбор таблицы для просмотра
Удаление: Пункт 3 → выбор таблицы → ввод ID элемента
Добавление: Пункт 4 → выбор таблицы → ввод данных
Запросы: Пункт 5 → выбор запроса (1-4)
Сохранение: Пункт 6 → подтверждение сохранения
